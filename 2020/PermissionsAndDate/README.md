# Разрешения, работа с датой и временем


Задача
Цель задания
В этом задании вы научитесь работать с разрешениями различных уровней, добавите в приложение Runtime разрешения, поработаете с местоположением пользователя, датой и временем в приложении.



Что нужно сделать
Добавьте в манифест разрешение уровня normal — INTERNET.
Добавьте в манифест разрешение уровня dangerous — ACCESS_FINE_LOCATION.
При открытии экрана приложения проверяйте, дано ли разрешение ACCESS_FINE_LOCATION приложению.
Если доступа нет — отобразите заглушку с надписью, что для получения списка локаций необходим доступ к разрешениям


Если доступ есть — отобразите список местоположений пользователя. Изначально показывайте пустой список и отобразите кнопку получения местоположения.


При нажатии на кнопку «Разрешить» должно запрашиваться разрешение ACCESS_FINE_LOCATION.


Если пользователь запретил доступ к локации — отобразите сообщение о невозможности получить локацию без разрешения. Экран должен остаться в состоянии из пункта 3.
Если пользователь разрешил доступ к местоположению — экран должен перейти в состояние пункта 4.
Подключите Google Play Services для работы с локацией.
Подключите ThreeTenABP для работы с датой и временем, инициализируйте библиотеку при запуске приложения.
При нажатии на кнопку «Получить локацию» запросите последнее местоположение пользователя у Google Play Services.
Если последняя локация существует — добавьте её в dataset локаций. Каждый элемент из dataset должен содержать следующую информацию:
идентификатор локации — генерируйте случайный id при создании элемента;
метку времени, когда локация получена, — Instant (по умолчанию получите текущую метку времени при создании элемента);
данные по локации (lat, lng, accuracy, speed и другие по усмотрению);
ссылку на изображение из интернета.
Отобразите элементы из dataset в списке:
данные по локации выведите в текстовое поле элемента;
отобразите изображение по ссылке в ImageView слева;
отобразите дату и время получения локации в формате «20:35 09.10.2020», используйте часовой пояс по умолчанию.


При нажатии на элемент локации пользователь должен суметь вручную установить дату и время её получения с помощью DatePickerDialog и TimePickerDialog.


По умолчанию при открытии пикеров должны быть установлены дата и время из выбранного элемента локации. После выбора даты и времени метку времени необходимо обновить в списке, для этого используйте обновление метки времени в dataset по идентификатору.
Используйте эмулятор с версией ОС < Android 6. Убедитесь, что приложение работает корректно. Разрешение местоположения должно быть одобрено во время установки, и экран из пункта 3 не должен появляться.
* Добавьте отслеживание изменения местоположения пользователя с помощью метода FusedLocationProviderClient.requestLocationUpdates. При изменении местоположения автоматически добавляйте новое местоположение в список.
* Добавьте проверку присутствия на устройстве Google play services. В случае отсутствия Google play services — отобразите диалог ошибки с невозможностью его закрыть (параметр isCancelable). В случае, если Google Play Services необходимо обновить, — отобразите диалог, позволяющий обновить их.


Советы и рекомендации
Загружайте изображение из интернета в элементе списка локаций с помощью специальных библиотек, например Glide или Picasso.
Добавьте к RecyclerView paddingBottom + clipToPadding=false для того, чтобы последний элемент списка локаций можно было всегда проскроллить выше кнопки «Получить локацию».
Используйте DiffUtil для обновления списка местоположений.


Критерии оценки
Код оформлен в соответствии с правилами Coding conventions.
Соблюдён принцип инкапсуляции с помощью модификаторов доступа.
Классы являются нефинальными (open, abstract) только при необходимости.
Текстовые строки не являются захардкоженными и используются из ресурсов.
При работе с локацией необходимо перед каждым действием проверять, что разрешение было одобрено.
При отборе разрешения через настройки приложения пользовательский интерфейс меняется соответствующим образом (переходит в состояние из пункта 3).
Для пользователя отображается информация, позволяющая понять, зачем запрашивается разрешение.
Для работы с локацией используются Google Play Services.
При изменении часовых поясов в настройках и при перезапуске приложения время получения локации должно быть в правильном часовом поясе.
Для работы с датой и временем необходимо использовать классы из JSR-310 backport (ThreeTen ABP).


Как отправить задание на проверку
Используйте репозиторий learning_materials/android_basic.
Скачайте изменения в репозитории на локальную машину.
Выполните домашнее задание в папке PermissionsAndDate.
Отправьте коммиты в удалённый репозиторий.


Дополнительные материалы

Codelab по работе с локацией (requestLocationUpdates)
Проверка наличия Google play services